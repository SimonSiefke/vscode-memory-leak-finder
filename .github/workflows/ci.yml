name: CI

on:
  push:
    branches:
      - main

# Sets permissions of the GITHUB_TOKEN to allow deployment to GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

jobs:
  ci:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-24.04, macos-26, windows-2025]
    timeout-minutes: 1000
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version-file: '.nvmrc'
      - name: Compute node modules cache key
        id: nodeModulesCacheKey
        run: echo "value=$(node scripts/computeNodeModulesCacheKey.js)" >> $GITHUB_OUTPUT
        shell: bash
      - uses: actions/cache@v5
        id: npm-cache
        with:
          path: |
            **/node_modules
            **/.vscode-test
            **/.vscode-insiders-versions
            **/.vscode-user-data-dir
            **/.vscode-ffmpeg
            **/.vscode-resolve-source-map-cache
          key: ${{ runner.os }}-cacheNodeModules-${{ steps.nodeModulesCacheKey.outputs.value }}
      - name: Compute source maps cache key
        id: sourceMapsCacheKey
        run: echo "value=$(node packages/build/src/computeSourceMapsCacheKey.ts)" >> $GITHUB_OUTPUT
        shell: bash
      - uses: actions/cache@v5
        id: source-maps-cache
        with:
          path: |
            **/.vscode-source-maps
            **/.vscode-sources
          key: ${{ runner.os }}-cacheSourceMaps-${{ steps.sourceMapsCacheKey.outputs.value }}
      - name: npm ci
        run: npm ci --ignore-scripts && npm run postinstall
        if: steps.npm-cache.outputs.cache-hit != 'true'
      - run: npm run type-check
      - run: npm run lint
      - run: npm run build
      - run: npm test
      - name: Run headless test (with videos)
        if: matrix.os != 'macos-26'
        uses: coactions/setup-xvfb@v1
        with:
          run: node packages/cli/bin/test.js --cwd packages/e2e --record-video
      - name: Run headless test
        uses: coactions/setup-xvfb@v1
        with:
          run: npm run e2e
      - name: Run headless test (flakyness check)
        if: matrix.os != 'macos-26'
        uses: coactions/setup-xvfb@v1
        with:
          run: npm run e2e:check-flakyness
      - name: Run headless test (second flakyness check)
        if: matrix.os != 'macos-26'
        uses: coactions/setup-xvfb@v1
        with:
          run: npm run e2e:check-flakyness
      - name: Run headless test (check leaks)
        if: matrix.os != 'macos-26'
        uses: coactions/setup-xvfb@v1
        with:
          run: node packages/cli/bin/test.js --cwd packages/e2e --check-leaks --measure-after
      - uses: actions/upload-artifact@v6
        if: always()
        with:
          name: vscode-videos-${{ runner.os }}
          path: ./.vscode-videos
          include-hidden-files: true

  ci-linux-measures:
    runs-on: ubuntu-24.04
    needs: ci
    strategy:
      fail-fast: false
      matrix:
        measure:
          - name: event-listeners
            args: --measure event-listeners --runs 17
          - name: event-listener-count
            args: --measure event-listener-count
          - name: dom-counters
            args: --measure dom-counters
          - name: detached-dom-node-count
            args: --measure detached-dom-node-count
          - name: promise-count
            args: --measure promise-count
          - name: promises-with-stack-trace
            args: --measure promises-with-stack-trace --runs 37  --restart-between --run-skipped-tests-anyway
          - name: promises-with-stack-trace-extensions
            args: --measure promises-with-stack-trace --runs 37 --restart-between --run-skipped-tests-anyway --inspect-extensions
          - name: named-array-count
            args: --measure named-array-count
          - name: array-count
            args: --measure array-count
          - name: css-rule-count
            args: --measure css-rule-count
          - name: regex-count
            args: --measure regex-count
          - name: edit-context-count
            args: --measure edit-context-count
          - name: function-count
            args: --measure function-count
          - name: named-function-count3
            args: --measure named-function-count3 --runs 37 --restart-between --run-skipped-tests-anyway
          - name: named-function-count3-shared-process
            args: --measure named-function-count3 --runs 37 --restart-between --run-skipped-tests-anyway --inspect-shared-process
          - name: named-function-count3-extensions
            args: --measure named-function-count3 --runs 37 --restart-between --run-skipped-tests-anyway --inspect-extensions
          - name: named-function-count3-node
            args: --measure named-function-count3 --runs 37 --restart-between --run-skipped-tests-anyway --measure-node
          - name: named-function-count3-pty-host
            args: --measure named-function-count3 --runs 37 --restart-between --run-skipped-tests-anyway --inspect-ptyhost
          - name: mutation-observer-count
            args: --measure mutation-observer-count
          - name: resize-observer-count
            args: --measure resize-observer-count
          - name: intersection-observer-count
            args: --measure intersection-observer-count
          - name: weak-map-count
            args: --measure weak-map-count
          - name: number-count
            args: --measure number-count
          - name: error-count
            args: --measure error-count
          - name: weak-set-count
            args: --measure weak-set-count
          - name: map-size
            args: --measure map-size
          - name: set-size
            args: --measure set-size
          - name: canvas-count
            args: --measure canvas-count
          - name: canvas-rendering-context-2d-count
            args: --measure canvas-rendering-context-2d-count
          - name: gpu-canvas-context-count
            args: --measure gpu-canvas-context-count
          - name: image-bitmap-count
            args: --measure image-bitmap-count
          - name: webgl2-rendering-context-count
            args: --measure webgl2-rendering-context-count
          - name: iframe-count
            args: --measure iframe-count
          - name: media-query-list-count
            args: --measure media-query-list-count
          - name: message-port-count
            args: --measure message-port-count
          - name: symbol-count
            args: --measure symbol-count
          - name: object-count
            args: --measure object-count
          - name: disposable-count
            args: --measure disposable-count
          - name: worker-count
            args: --measure worker-count
          - name: detached-dom-nodes-with-stack-traces
            args: --measure detached-dom-nodes-with-stack-traces --runs 37 --restart-between --run-skipped-tests-anyway
          - name: file-descriptor-count
            args: --measure file-descriptor-count --runs 37 --restart-between --run-skipped-tests-anyway
    timeout-minutes: 360
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version-file: '.nvmrc'
      - name: Compute node modules cache key
        id: nodeModulesCacheKey
        run: echo "value=$(node scripts/computeNodeModulesCacheKey.js)" >> $GITHUB_OUTPUT
        shell: bash
      - uses: actions/cache@v5
        id: npm-cache
        with:
          path: |
            **/node_modules
            **/.vscode-test
            **/.vscode-insiders-versions
            **/.vscode-user-data-dir
            **/.vscode-ffmpeg
            **/.vscode-resolve-source-map-cache
          key: ${{ runner.os }}-cacheNodeModules-${{ steps.nodeModulesCacheKey.outputs.value }}
      - name: Compute source maps cache key
        id: sourceMapsCacheKey
        run: echo "value=$(node packages/build/src/computeSourceMapsCacheKey.ts)" >> $GITHUB_OUTPUT
        shell: bash
      - uses: actions/cache@v5
        id: source-maps-cache
        with:
          path: |
            **/.vscode-source-maps
            **/.vscode-sources
          key: ${{ runner.os }}-cacheSourceMaps-${{ steps.sourceMapsCacheKey.outputs.value }}
      - name: npm ci
        run: npm ci --ignore-scripts && npm run postinstall
        if: steps.npm-cache.outputs.cache-hit != 'true'
      - run: npm run build
      - name: Run headless test (check leaks, ${{ matrix.measure.name }})
        uses: coactions/setup-xvfb@v1
        with:
          run: node packages/cli/bin/test.js --cwd packages/e2e --check-leaks --measure-after ${{ matrix.measure.args }}
      - uses: actions/upload-artifact@v6
        if: always()
        with:
          name: vscode-memory-leak-finder-results-linux-${{ matrix.measure.name }}
          path: ./.vscode-memory-leak-finder-results
          include-hidden-files: true

  ci-linux-charts:
    runs-on: ubuntu-24.04
    needs: ci-linux-measures
    timeout-minutes: 60
    steps:
      - uses: actions/checkout@v6
      - uses: actions/setup-node@v6
        with:
          node-version-file: '.nvmrc'
      - name: Compute node modules cache key
        id: nodeModulesCacheKey
        run: echo "value=$(node scripts/computeNodeModulesCacheKey.js)" >> $GITHUB_OUTPUT
        shell: bash
      - uses: actions/cache@v5
        id: npm-cache
        with:
          path: |
            **/node_modules
            **/.vscode-test
            **/.vscode-insiders-versions
            **/.vscode-user-data-dir
            **/.vscode-ffmpeg
            **/.vscode-resolve-source-map-cache
          key: ${{ runner.os }}-cacheNodeModules-${{ steps.nodeModulesCacheKey.outputs.value }}
      - name: npm ci
        run: npm ci --ignore-scripts && npm run postinstall
        if: steps.npm-cache.outputs.cache-hit != 'true'
      - run: npm run type-check
      - run: npm run lint
      - run: npm run build
      - name: Download all measure results
        uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-event-listeners
          path: ./vscode-memory-leak-finder-results-linux-event-listeners
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-event-listener-count
          path: ./vscode-memory-leak-finder-results-linux-event-listener-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-dom-counters
          path: ./vscode-memory-leak-finder-results-linux-dom-counters
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-detached-dom-node-count
          path: ./vscode-memory-leak-finder-results-linux-detached-dom-node-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promise-count
          path: ./vscode-memory-leak-finder-results-linux-promise-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promises-with-stack-trace
          path: ./vscode-memory-leak-finder-results-linux-promises-with-stack-trace
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promises-with-stack-trace-extensions
          path: ./vscode-memory-leak-finder-results-linux-promises-with-stack-trace-extensions
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-array-count
          path: ./vscode-memory-leak-finder-results-linux-named-array-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-array-count
          path: ./vscode-memory-leak-finder-results-linux-array-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-css-rule-count
          path: ./vscode-memory-leak-finder-results-linux-css-rule-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-regex-count
          path: ./vscode-memory-leak-finder-results-linux-regex-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-edit-context-count
          path: ./vscode-memory-leak-finder-results-linux-edit-context-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-function-count
          path: ./vscode-memory-leak-finder-results-linux-function-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3
          path: ./vscode-memory-leak-finder-results-linux-named-function-count3
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-shared-process
          path: ./vscode-memory-leak-finder-results-linux-named-function-count3-shared-process
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-extensions
          path: ./vscode-memory-leak-finder-results-linux-named-function-count3-extensions
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-node
          path: ./vscode-memory-leak-finder-results-linux-named-function-count3-node
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-pty-host
          path: ./vscode-memory-leak-finder-results-linux-named-function-count3-pty-host
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-mutation-observer-count
          path: ./vscode-memory-leak-finder-results-linux-mutation-observer-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-resize-observer-count
          path: ./vscode-memory-leak-finder-results-linux-resize-observer-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-intersection-observer-count
          path: ./vscode-memory-leak-finder-results-linux-intersection-observer-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-weak-map-count
          path: ./vscode-memory-leak-finder-results-linux-weak-map-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-number-count
          path: ./vscode-memory-leak-finder-results-linux-number-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-error-count
          path: ./vscode-memory-leak-finder-results-linux-error-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-weak-set-count
          path: ./vscode-memory-leak-finder-results-linux-weak-set-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-map-size
          path: ./vscode-memory-leak-finder-results-linux-map-size
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-set-size
          path: ./vscode-memory-leak-finder-results-linux-set-size
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-canvas-count
          path: ./vscode-memory-leak-finder-results-linux-canvas-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-canvas-rendering-context-2d-count
          path: ./vscode-memory-leak-finder-results-linux-canvas-rendering-context-2d-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-gpu-canvas-context-count
          path: ./vscode-memory-leak-finder-results-linux-gpu-canvas-context-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-image-bitmap-count
          path: ./vscode-memory-leak-finder-results-linux-image-bitmap-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-webgl2-rendering-context-count
          path: ./vscode-memory-leak-finder-results-linux-webgl2-rendering-context-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-iframe-count
          path: ./vscode-memory-leak-finder-results-linux-iframe-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-media-query-list-count
          path: ./vscode-memory-leak-finder-results-linux-media-query-list-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-message-port-count
          path: ./vscode-memory-leak-finder-results-linux-message-port-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-symbol-count
          path: ./vscode-memory-leak-finder-results-linux-symbol-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-object-count
          path: ./vscode-memory-leak-finder-results-linux-object-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-disposable-count
          path: ./vscode-memory-leak-finder-results-linux-disposable-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-worker-count
          path: ./vscode-memory-leak-finder-results-linux-worker-count
      - uses: actions/download-artifact@v6
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-detached-dom-nodes-with-stack-traces
          path: ./vscode-memory-leak-finder-results-linux-detached-dom-nodes-with-stack-traces
      - name: Merge all measure results
        run: node packages/build/src/mergeArtifacts.ts
      - name: Upload merged artifact
        uses: actions/upload-artifact@v6
        if: always()
        with:
          name: vscode-memory-leak-finder-results-linux
          path: ./.vscode-memory-leak-finder-results
          include-hidden-files: true
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-resize-observer-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-set-size
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-symbol-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-weak-map-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-weak-set-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-webgl2-rendering-context-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-worker-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-detached-dom-nodes-with-stack-traces
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-event-listeners
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-event-listener-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-dom-counters
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-detached-dom-node-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promise-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promises-with-stack-trace
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-promises-with-stack-trace-extensions
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-array-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-array-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-css-rule-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-regex-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-edit-context-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-function-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-shared-process
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-extensions
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-node
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-named-function-count3-pty-host
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-mutation-observer-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-intersection-observer-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-number-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-error-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-map-size
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-canvas-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-canvas-rendering-context-2d-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-gpu-canvas-context-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-image-bitmap-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-iframe-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-media-query-list-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-message-port-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-object-count
      - name: Delete individual artifacts
        uses: geekyeggo/delete-artifact@v5
        continue-on-error: true
        with:
          name: vscode-memory-leak-finder-results-linux-disposable-count
      - name: Generate charts
        run: node packages/charts/src/main.ts
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v4
        with:
          path: ./.vscode-charts

  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-24.04
    needs: [ci, ci-linux-charts]
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4
